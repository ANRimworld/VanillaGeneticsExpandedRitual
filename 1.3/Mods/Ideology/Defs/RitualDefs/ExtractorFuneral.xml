<?xml version="1.0" encoding="utf-8" ?>
<Defs>

	
	
	<!--Ritual Pattern-->
	<RitualPatternDef>
		<defName>GR_ExtractorFuneralPattern</defName>
		<nameMaker>NamerRitualFuneral</nameMaker>
		<ritualExpectedDesc>Once a {IDEO} member dies, other {MEMBERS} witnesss {RITUAL_labelDef} to ensure they live on.</ritualExpectedDesc>
		<ritualObligationTriggers>
		  <li Class="RitualObligationTrigger_MemberDiedProperties">
			<mustBePlayerIdeo>true</mustBePlayerIdeo>
		  </li>
		</ritualObligationTriggers>
		<ritualObligationTargetFilter>GR_ExtractGenomeObligation</ritualObligationTargetFilter>
		<ritualBehavior>GR_ExtractorFuneralBehavior</ritualBehavior>
		<ritualOutcomeEffect>GR_ExtractorFuneralOutcome</ritualOutcomeEffect>
	</RitualPatternDef>

	<!--Ritual Behavior-->
	<RitualBehaviorDef>
		<defName>GR_ExtractorFuneralBehavior</defName>
		<durationTicks>5000</durationTicks>
		<workerClass>GeneticRim.RitualBehaviorWorker_ExtractGenome</workerClass>
		<spectatorFilter Class="GeneticRim.RitualRoleGRCorpse_RitualSpectatorFilterNotCorpse">
		<description>Spectators must be alive.</description>
		</spectatorFilter>
		<roles>
		  <li Class="RitualRoleTag">
			<label>speaker</label>
			<id>moralist</id>
			<precept>IdeoRole_Moralist</precept>
			<tag>Moralist</tag>
			<maxCount>1</maxCount>
			<substitutable>true</substitutable>
			<countsAsParticipant>False</countsAsParticipant>
		  </li>
		  <li Class="GeneticRim.RitualRoleGRCorpse">
			<label>Corpse</label>
			<id>GR_RitualRoleCorpse</id>        
			<maxCount>1</maxCount>
			<allowOtherIdeos>false</allowOtherIdeos>
			<allowNonAggroMentalState>true</allowNonAggroMentalState>
			<required>True</required>		
			<countsAsParticipant>False</countsAsParticipant>
		  </li>
		</roles>
		<stages>
			<li Class="RitualStage_InteractWithRole">
				<defaultDuty>Spectate</defaultDuty>
				<targetId>GR_RitualRoleCorpse</targetId> 
				<endTriggers>
					<li Class="StageEndTrigger_RolesArrived">
						<roleIds>
						  <li>moralist</li>
						</roleIds>
					</li>	
				</endTriggers>				
				<roleBehaviors>
				  <li>
					<roleId>moralist</roleId>
					<dutyDef>GR_DeliverCorpseToCellDuty</dutyDef>
				  </li>				  
				</roleBehaviors>
			</li>    
			<li>
				<defaultDuty>Spectate</defaultDuty>
				<endTriggers>
				  <li Class="StageEndTrigger_DurationPercentage">
					<percentage>0.3</percentage>
				  </li>
				</endTriggers>
				<roleBehaviors>
				  <li>
					<roleId>moralist</roleId>
					<dutyDef>SpeakOnCellFuneral</dutyDef>
				  <speakerInteraction>Speech_Funeral</speakerInteraction>
					<customPositions>					  
					  <li Class="RitualPosition_BesideThing" />
					</customPositions>
				  </li>
				</roleBehaviors>
				<visualEffectDef>Funeral</visualEffectDef>
				<postAction Class="RitualStageAction_Message">
					<text>{0}: The speech is over, and the extraction is beginning.</text>
					<messageTypeDef>NeutralEvent</messageTypeDef>
				</postAction>
				<preAction Class="GeneticRim.RitualStageAction_GRExtractGenome">				
					  <sound>Recipe_Cremate</sound>
					  <effect>ButcherFlesh</effect>
				</preAction>				
			</li>
			<li>
				<defaultDuty>Spectate</defaultDuty>
				<endTriggers>
				  <li Class="StageEndTrigger_DurationPercentage">
					<percentage>0.7</percentage>
				  </li>
				</endTriggers>
				<roleBehaviors>
				  <li>
					<roleId>moralist</roleId>
					<dutyDef>ArriveToCell</dutyDef>				  
					<customPositions>					  
					  <li Class="RitualPosition_OnInteractionCell"/>
					</customPositions>
				  </li>
				</roleBehaviors>
				<visualEffectDef>Funeral</visualEffectDef>

			</li>
		</stages>
  </RitualBehaviorDef>
   



   
  <!--Ritual Outcome-->
    <RitualOutcomeEffectDef>
	<defName>GR_ExtractorFuneralOutcome</defName>
    <description>Depending on ritual quality, participants will get between {MINMOOD} and {MAXMOOD} mood for {MOODDAYS} days.</description>
    <workerClass>GeneticRim.RitualOutcomeEffectWorker_GRExtractGenome</workerClass>
    <allowAttachableOutcome>false</allowAttachableOutcome>
    <outcomeChances>
      <li>
        <label>Terrible</label>
        <chance>0.05</chance>
        <memory>GR_TerribleExtraction</memory>
        <description>The {0} was a terrible! Everyone felt devestated for having to see the genomes destroyed.</description>
        <positivityIndex>-2</positivityIndex>
      </li>
      <li>
        <label>Lackluster</label>
        <chance>0.15</chance>
        <memory>GR_LacklusterExtraction</memory>
        <description>The {0} was lackluster. The speech was long-winded and failed to invoke the imagination.</description>
        <positivityIndex>-1</positivityIndex>
      </li>
      <li>
        <label>Good</label>
        <chance>0.6</chance>
        <memory>GR_GoodExtraction</memory>
        <description>The {0} was good. The speaker's final words provided hope for the creations.</description>
        <positivityIndex>1</positivityIndex>
      </li>
      <li>
        <label>Amazing</label>
        <chance>0.2</chance>
        <memory>GR_AmazingExtraction</memory>
        <description>The {0} was Amazing. The speech was captivating, and everyone came away focused on the creations that could be made.</description>
        <positivityIndex>2</positivityIndex>
      </li>
    </outcomeChances>
	<comps>
      <li Class="RitualOutcomeComp_RolePresentNotSubstituted">
        <roleId>moralist</roleId>
        <label>moral guide present</label>
        <qualityOffset>0.2</qualityOffset>
        <disableInClassicMode>true</disableInClassicMode>
      </li>
      <li Class="RitualOutcomeComp_ParticipantCount">
        <label>participant count</label>
        <curve>
          <points>
            <li>(1,  0.0)</li>
            <li>(5,  0.4)</li>
            <li>(10, 0.6)</li>
          </points>
        </curve>
      </li>
    </comps>
  </RitualOutcomeEffectDef>
 
   <!--Ritual Obligation-->
	<RitualObligationTargetFilterDef>
		<defName>GR_ExtractGenomeObligation</defName>
		<workerClass>GeneticRim.RitualObligationTargetWorker_GR_GeneticExtractionTable</workerClass>		
		<thingDefs>
		  <li>GR_GeneticExtractionTable</li>		  
		</thingDefs>
	</RitualObligationTargetFilterDef>
</Defs>